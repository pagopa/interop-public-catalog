---
import { ORGANIZATION_TYPES, type OrganizationType } from '../../config/constants'
import { getLocalizedRoute } from '../../config/routes'
import { useHomepageTranslations } from '../../i18n/homepage.i18n'
import { getLangFromUrl } from '../../i18n/utils.i18n'
import { BootstrapItaliaIcon } from '../shared/BootstrapItaliaIcon'
import { GoodPracticeCard } from '../shared/GoodPracticeCard'

const currentLocale = getLangFromUrl(Astro.url.pathname)
const t = useHomepageTranslations(currentLocale)

const organizationsTypesLinks: Array<{ text: string; organizationTypeKey: OrganizationType }> = [
  { text: t('use_cases.target.pa_centrali'), organizationTypeKey: 'pac' },
  { text: t('use_cases.target.regioni'), organizationTypeKey: 'regioni' },
  { text: t('use_cases.target.comuni'), organizationTypeKey: 'comuni' },
  { text: t('use_cases.target.view_all'), organizationTypeKey: 'tutti' },
] as const

function getOrganizationTypeHref(organizationType: OrganizationType) {
  return `${getLocalizedRoute(currentLocale, 'GOOD_PRACTICES_CATALOG')}?${new URLSearchParams({ organizationType }).toString()}`
}

function getOrganizationTypeImgSrc(organizationType: OrganizationType) {
  return ORGANIZATION_TYPES.find((o) => o.key === organizationType)!.imgSrc
}
---

<section class="section position-relative pb-0" aria-labelledby="use-cases-section-title">
  {/* Background - Mobile */}
  <div
    aria-hidden="true"
    style="inset:0;z-index:-1;"
    class="position-absolute d-md-none bg-primary-c0"
  >
  </div>
  <div class="position-relative">
    {/* Background - Desktop */}
    <div
      aria-hidden="true"
      style="inset:0;max-width:865px;z-index:-1;"
      class="position-absolute mx-auto rounded-5 border border-primary d-none d-md-block bg-primary-c0"
    >
    </div>

    <div style="max-width:856px;" class="mx-auto pt-md-5 px-md-5">
      {/* Section Header - Title and Description*/}
      <div>
        <h2 id="use-cases-section-title" class="text-primary h4">{t('use_cases.title')}</h2>
        <p class="text-secondary">
          {t('use_cases.description')}
        </p>
      </div>

      <div class="it-list-wrapper mt-4">
        <ul class="it-list row">
          {
            organizationsTypesLinks.map((l, i) => (
              <li class:list={['col-12 col-md-6 px-2 py-2 position-relative']}>
                <a
                  href={getOrganizationTypeHref(l.organizationTypeKey)}
                  class="list-item icon-right gap-2 border-0"
                >
                  <img
                    src={getOrganizationTypeImgSrc(l.organizationTypeKey)}
                    alt=""
                    role="presentation"
                    height="40"
                    width="40"
                  />
                  <div class="it-right-zone">
                    <span style="font-size:1rem;" class="text">
                      {l.text}
                    </span>
                    <BootstrapItaliaIcon name="it-chevron-right" size="sm" color="primary" />
                  </div>
                </a>
                {i <= 2 && (
                  <div
                    style="height:1px;background-color:var(--bs-border-color);bottom:0px;"
                    class:list={['position-absolute w-100 px-4', i === 2 && 'd-block d-md-none']}
                    role="presentation"
                  />
                )}
              </li>
            ))
          }
        </ul>
      </div>
    </div>

    {/* Section Content - Use Case Cards */}
    <div style="max-width:1076px;" class="mx-auto mt-5">
      <div class="row g-4">
        <div class="col-12 col-md-6 d-flex justify-content-center">
          <GoodPracticeCard
            currentLocale={currentLocale}
            title="Erogare i bonus ai cittadini in modo equo ed efficiente"
            intendedTargets={['pac', 'comuni', 'regioni', 'universita']}
            category="Bonus Economici"
          />
        </div>
        <div class="col-12 col-md-6 d-flex justify-content-center">
          <GoodPracticeCard
            currentLocale={currentLocale}
            title="Iscrizione ai concorsi pubblici più snella"
            intendedTargets={['pac', 'comuni', 'regioni', 'universita']}
            category="Titoli di studio"
          />
        </div>
        <div class="col-12 col-md-6 d-flex justify-content-center">
          <GoodPracticeCard
            currentLocale={currentLocale}
            title="Verifica immediata dell’iscrizione all’albo degli avvocati"
            intendedTargets={['pac', 'comuni', 'regioni', 'universita']}
            category="Ordini professionali"
          />
        </div>
        <div class="col-12 col-md-6 d-flex justify-content-center">
          <GoodPracticeCard
            currentLocale={currentLocale}
            title="Erogare i bonus ai cittadini in modo equo ed efficiente"
            intendedTargets={['pac', 'comuni', 'regioni', 'universita']}
            category="Bonus Economici"
          />
        </div>
      </div>
    </div>

    {/* Section Footer - Call to Action */}
    <div class="d-flex justify-content-center mt-5 pb-5">
      <a
        href={getLocalizedRoute(currentLocale, 'GOOD_PRACTICES_CATALOG')}
        id="explore-examples-button"
        class="btn btn-outline-primary"
      >
        {t('use_cases.footer_cta')}
      </a>
    </div>
  </div>
</section>
