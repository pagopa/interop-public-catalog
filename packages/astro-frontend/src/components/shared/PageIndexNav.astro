---
import type { HTMLAttributes } from 'astro/types'

interface Props extends HTMLAttributes<'nav'> {
  title?: string
  headings: { id: string; label: string }[]
}

const { headings, title, ...rest } = Astro.props
---

<nav class:list={['link-list-wrapper', rest.class]} {...rest}>
  {
    title && (
      <h2 class="h4" class="link-list-heading">
        {title}
      </h2>
    )
  }
  <ul class="link-list mt-4 border-end">
    {
      headings.map((heading) => (
        <li>
          <a href={`#${heading.id}`} class="link-list-item active py-3 fw-semibold lh-base">
            {heading.label}
          </a>
        </li>
      ))
    }
  </ul>
</nav>

<script is:inline define:vars={{ headings }}>
  const linkActiveClass = 'active-link-list-item'
  window.addEventListener('scroll', () => {
    const linkItems = document.querySelectorAll('.link-list-item')
    let closestId = null
    let minAbsTop = Infinity

    headings.forEach(({ id }) => {
      const section = document.getElementById(id)
      if (section) {
        const absTop = Math.abs(section.getBoundingClientRect().top)
        if (absTop < minAbsTop) {
          minAbsTop = absTop
          closestId = id
        }
      }
    })

    linkItems.forEach((item) => item.classList.remove(linkActiveClass))
    if (closestId) {
      const linkItem = document.querySelector(`.link-list-item[href="#${closestId}"]`)
      if (linkItem) {
        linkItem.classList.add(linkActiveClass)
      }
    }
  })
</script>
