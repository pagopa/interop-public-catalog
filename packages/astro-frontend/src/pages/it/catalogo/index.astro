---
import Layout from '../../../layouts/Layout.astro'
import SuggestionSection from '../../../components/shared/SuggestionSection.astro'
import PageHero from '..//../../components/shared/PageHero.astro'
import { useCatalogTranslations } from '../../../i18n/catalog.i18n'
import { getLangFromUrl } from '../../../i18n/utils.i18n'

import { EServiceCatalogApp } from '../../../components/EServiceCatalog/EServiceCatalogApp'
import RatingSection from '../../../components/shared/RatingSection.astro'
import { Section } from '../../../components/shared/Section'
import { links } from '../../../config/constants'
// import { sqlService } from '../../../server/services'
// import type { EServiceQuery } from 'pagopa-interop-public-models'

const currentLocale = getLangFromUrl(Astro.url.pathname)
const t = useCatalogTranslations(currentLocale)

// const getParams = () => {
//   const q = Astro.url.searchParams.get('q') || ''
//   const limit = 12 // Put default on serve side
//   const offset = parseInt(Astro.url.searchParams.get('offset') || '0', 10) || 0
//   const categories = JSON.parse(Astro.url.searchParams.get('consumer') || '[]').map(
//     (it: [string, string]) => it[0]
//   )
//   const producerIds: string[] = JSON.parse(Astro.url.searchParams.get('provider') || '[]').map(
//     (it: [string, string]) => it[1]
//   )
//   const orderBy = [Astro.url.searchParams.get('orderBy') || 'recent_desc']

//   const params = {
//     q,
//     offset,
//     categories,
//     producerIds,
//     orderBy,
//     limit,
//   }

//   return Object.fromEntries(
//     Object.entries(params).filter(([_, value]) => {
//       if (Array.isArray(value)) return value.length > 0
//       return value !== '' && value !== null && value !== undefined
//     })
//   )
// }

// const eservicesList = await sqlService.searchCatalog(getParams() as EServiceQuery)
---

<div class="start">
  <Layout>
    <PageHero
      title={t('title')}
      description={t('description')}
      breadcrumbItems={[
        {
          routeKey: 'HOME',
        },
        {
          routeKey: 'ESERVICE_CATALOG',
          current: true,
        },
      ]}
    />

    <Section className="section-muted">
      <EServiceCatalogApp client:only="react" />
    </Section>

    <RatingSection />
    <SuggestionSection
      leftCard={{
        title: t('suggestion_section.left_card.title'),
        description: t('suggestion_section.left_card.description'),
        buttonLabel: t('suggestion_section.left_card.button_label'),
        href: links.interopPlatformLink,
        externalLink: true,
        imageSrc: '/img/077-network-primary-color.svg',
      }}
      rightCard={{
        title: t('suggestion_section.right_card.title'),
        description: t('suggestion_section.right_card.description'),
        buttonLabel: t('suggestion_section.right_card.button_label'),
        href: links.interopNumbersLink,
        externalLink: true,
        imageSrc: '/img/080-growth-graph.svg',
      }}
    />
  </Layout>
</div>
