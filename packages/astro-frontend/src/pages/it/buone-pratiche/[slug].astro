---
import Layout from '../../../layouts/Layout.astro'
import { GoodPracticeCard } from '../../../components/shared/GoodPracticeCard'
import { Section } from '../../../components/shared/Section'
import { Chip } from '../../../components/shared/Chip'
import PageHero from '../../../components/shared/PageHero.astro'
import { BootstrapItaliaIcon } from '../../../components/shared/BootstrapItaliaIcon'
import { getLangFromUrl } from '../../../i18n/utils.i18n'
import { useGoodPracticesTranslations } from '../../../i18n/good-practices.i18n'
import { useUiTranslations } from '../../../i18n/ui.i18n'
import GoodPracticeDetails from '../../../components/GoodPracticeDetails/GoodPracticeDetails.astro'
import { strapiService } from '../../../server/services'

const currentLocale = getLangFromUrl(Astro.url.pathname)
const tGoodPractices = useGoodPracticesTranslations(currentLocale)
const tUi = useUiTranslations(currentLocale)

const goodPracticeStrapiResponse = await strapiService.getGoodPracticeBySlug(
  Astro.params.slug!,
  currentLocale
)

const randomGoodPractices = await strapiService.getGoodPractices(
  { limit: 0, offset: 2 },
  currentLocale
)

if (!goodPracticeStrapiResponse) {
  return Astro.redirect('/404')
}

const goodPractice = goodPracticeStrapiResponse.data
---

<Layout>
  <PageHero
    title={goodPractice.title}
    breadcrumbItems={[
      {
        routeKey: 'HOME',
      },
      {
        routeKey: 'GOOD_PRACTICES_CATALOG',
      },
      {
        routeKey: 'GOOD_PRACTICES_DETAILS',
        current: true,
      },
    ]}
  >
    <div slot="top-hero">
      <div class="d-flex align-items-center justify-content-between">
        <Chip label={goodPractice.category} />
        <button class="btn btn-link fw-semibold text-decoration-none">
          <span>{tGoodPractices('details.copyUrl')}</span>
          <BootstrapItaliaIcon name="it-copy" className="ms-2" color="primary" />
        </button>
      </div>
    </div>

    <div slot="bottom-hero">
      <p>
        <strong>{tUi('label.for')}:</strong>
        {goodPractice.tenantMacrocategories.map((l) => l.label).join(', ')}
      </p>
    </div>
  </PageHero>

  <Section style={{ backgroundColor: '#fafafa' }}>
    <GoodPracticeDetails goodPracticeBody={goodPractice.body} />
  </Section>

  <Section
    style={{ backgroundColor: '#f5f5f5' }}
    title={tGoodPractices('details.moreExamples')}
    titleClass="text-center"
  >
    <div class="d-flex justify-content-center gap-4 mt-4">
      {
        randomGoodPractices.data.map((goodPractice) => (
          <GoodPracticeCard currentLocale={currentLocale} goodPractice={goodPractice} />
        ))
      }
    </div>
  </Section>
</Layout>
