---
import { Section } from '../../../components/shared/Section'
import { GoodPracticesCatalog } from '../../../components/GoodPracticesCatalog/GoodPracticesCatalog'
import { getLangFromUrl } from '../../../i18n/utils.i18n'
import { useGoodPracticesTranslations } from '../../../i18n/good-practices.i18n'
import Layout from '../../../layouts/Layout.astro'
import PageHero from '../../../components/shared/PageHero.astro'
import { z } from 'zod'

export const prerender = true

const currentLocale = getLangFromUrl(Astro.url.pathname)
const tGoodPractices = useGoodPracticesTranslations(currentLocale)

const parsedDefaultMacroCategoryId = z
  .number()
  .safeParse(parseInt(Astro.url.searchParams.get('macroCategoryId') ?? '', 10))

const defaultMacroCategoryId = parsedDefaultMacroCategoryId.success
  ? parsedDefaultMacroCategoryId.data
  : undefined
---

<Layout>
  <PageHero
    title={tGoodPractices('catalog.title')}
    description={tGoodPractices('catalog.subtitle')}
    breadcrumbItems={[
      {
        routeKey: 'HOME',
      },
      {
        routeKey: 'GOOD_PRACTICES_CATALOG',
        current: true,
      },
    ]}
  />

  <Section className="bg-muted">
    <GoodPracticesCatalog
      client:idle
      defaultMacroCategoryId={defaultMacroCategoryId}
      currentLocale={currentLocale}
    />
  </Section>
</Layout>
