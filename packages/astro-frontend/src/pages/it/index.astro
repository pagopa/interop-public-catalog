---
import Layout from '../../layouts/Layout.astro'
import HomepageHero from '../../components/Homepage/HomepageHero.astro'
import HowItWorks from '../../components/Homepage/HowItWorks.astro'
import GoodPractices from '../../components/Homepage/GoodPractices.astro'
import ApiShowcase from '../../components/Homepage/ApiShowcase.astro'
import SuggestionSection from '../../components/shared/SuggestionSection.astro'
import { EService } from '../../../../models/src/types/eservice'
import { getLangFromUrl } from '../../i18n/utils.i18n'
import { useHomepageTranslations } from '../../i18n/homepage.i18n'
import { EServiceId, EServiceTemplateId, TenantId } from '../../../../models/src/brandedIds'
import { strapiService } from '../../server/services'
import { links } from '../../config/constants'

//TODO right data
const highlightedEServices: EService[] = [
  {
    id: 'eservice1' as EServiceId,
    name: 'ANPR',
    description:
      "L'Anagrafe Nazionale della Popolazione Residente (ANPR) è il sistema che raccoglie i dati anagrafici di tutti i cittadini italiani.",
    attributes: {
      certified: [],
      declared: [],
      verified: [],
    },
    // producerName: "Nome dell'Ente",
    producerId: 'tenant1' as TenantId,
    technology: 'Rest',
    descriptors: [],
    createdAt: new Date(),
    mode: 'Deliver',
    isSignalHubEnabled: true,
    isConsumerDelegable: true,
    isClientAccessDelegable: true,
    templateId: 'eserviceTemplate1' as EServiceTemplateId,
  },
  {
    id: 'eservice2' as EServiceId,
    name: 'PagoPA',
    description:
      'PagoPA è il sistema di pagamenti elettronici della Pubblica Amministrazione italiana, che consente ai cittadini di effettuare pagamenti in modo semplice e sicuro.',
    attributes: {
      certified: [],
      declared: [],
      verified: [],
    },
    // producerName: "Nome dell'Ente",
    producerId: 'tenant2' as TenantId,
    technology: 'Rest',
    descriptors: [],
    createdAt: new Date(),
    mode: 'Deliver',
    isSignalHubEnabled: true,
    isConsumerDelegable: true,
    isClientAccessDelegable: true,
    templateId: 'eserviceTemplate2' as EServiceTemplateId,
  },
  {
    id: 'eservice3' as EServiceId,
    name: 'SPIDdnds ndsaj jkdsaknj dsanjk dksnaj kjdnasknj dsadsakdsanjkd sakjndnkjs akjndsaknj dakjsnkj ads',
    description:
      "SPID (Sistema Pubblico di Identità Digitale) è il sistema di autenticazione che permette ai cittadini di accedere ai servizi online della Pubblica Amministrazione e dei privati aderenti con un'unica identità digitale.",
    attributes: {
      certified: [],
      declared: [],
      verified: [],
    },
    // producerName: "Nome dell'Ente",
    producerId: 'tenant3' as TenantId,
    technology: 'Rest',
    descriptors: [],
    createdAt: new Date(),
    mode: 'Deliver',
    isSignalHubEnabled: true,
    isConsumerDelegable: true,
    isClientAccessDelegable: true,
    templateId: 'eserviceTemplate3' as EServiceTemplateId,
  },
]

const currentLocale = getLangFromUrl(Astro.url.pathname)
const t = useHomepageTranslations(currentLocale)

const featuredGoodPracticesStrapiResponse = await strapiService.getGoodPractices(
  { offset: 0, limit: 4, isFeaturedInHomepage: true },
  currentLocale
)
const featuredGoodPractices = featuredGoodPracticesStrapiResponse.data
---

<Layout>
  <HomepageHero />
  <HowItWorks />
  <GoodPractices featuredGoodPractices={featuredGoodPractices} />
  <ApiShowcase title={t('featured_api.title')} highlightedEServices={highlightedEServices} />
  <SuggestionSection
    leftCard={{
      title: t('suggestion_section.left_card.title'),
      description: t('suggestion_section.left_card.description'),
      buttonLabel: t('suggestion_section.left_card.button_label'),
      href: links.interopPlatformLink,
      externalLink: true,
      imageSrc: '/img/077-network-primary-color.svg',
    }}
    rightCard={{
      title: t('suggestion_section.right_card.title'),
      description: t('suggestion_section.right_card.description'),
      buttonLabel: t('suggestion_section.right_card.button_label'),
      href: links.interopManualLink,
      externalLink: true,
      imageSrc: '/img/059-data-collection.svg',
    }}
  />
</Layout>
