---
export const prerender = false

import Layout from '../../layouts/Layout.astro'
import UseCaseCard from '../../components/UseCaseCard'
import EServiceCard from '../../components/EServiceCard'
import SuggestionSection from '../../components/SuggestionsSection/SuggestionsSection.jsx'
import Hero from '../../components/Hero'
import HowToDoList from '../../components/HowToDoList/HowToDoList'
import { Button, Col, Icon, Row, Section } from 'design-react-kit'
import { TenantCard } from '../../components/TenantCard'

const articles = await fetch(new URL('/api/articles', Astro.url))
  .then((response) => response.json())
  .catch((_e) => ({ data: [{ title: 'Strapi is not connected...' }] }))

const catalogUrl = new URL('/api/catalog', Astro.url)
const q = 'comune'
catalogUrl.searchParams.set('q', q)
const eservices = await fetch(catalogUrl)
  .then((response) => response.json())
  .catch((_e) => ({ items: [{ title: 'PG is not connected...' }] }))
---

<Layout>
  <Hero client:load />
  <HowToDoList
    client:load
    title="Come funziona"
    howToList={[
      {
        icon: '/Group.svg',
        title: 'how to 1',
        description: 'how to description 1',
        readMoreHRef: '',
      },
      {
        icon: '/Group.svg',
        title: 'how to 2',
        description: 'how to description 2',
        readMoreHRef: '',
      },
      {
        icon: '/Group.svg',
        title: 'how to 3',
        description: 'how to description 3',
        readMoreHRef: '',
      },
    ]}
  />

  <Section client:load className="d-flex flex-column justify-content-center align-items-center">
    <div class="d-flex flex-column justify-content-center align-items-center mx-6 bg-transparent">
      <div class="d-flex flex-column justify-content-between text-center mb-3">
        <h3>Come puoi usare le API?</h3>
        <span>
          Seleziona la tipologia di Pubblica Amministrazione per cui operi e scopri come integrare
          le API nei processi del tuo ente per semplificare grazie all'interoperabilità i servizi
          che offre.
        </span>
      </div>
      <Row class="g-3">
        <Col>
          <TenantCard tenantName="Ente di appartenenza" icon="/Group.svg" />
        </Col>
        <Col>
          <TenantCard tenantName="Ente di appartenenza" icon="/Group.svg" />
        </Col>
        <Col>
          <TenantCard tenantName="Ente di appartenenza" icon="/Group.svg" />
        </Col>
        <Col>
          <TenantCard tenantName="Ente di appartenenza" icon="/Group.svg" />
        </Col>
        <Col>
          <TenantCard tenantName="Ente di appartenenza" icon="/Group.svg" />
        </Col>
      </Row>
    </div>

    <div
      class="d-flex flex-column justify-content-center align-items-center primary-bg-c1 rounded-5 mt-n3"
    >
      <div class="d-flex flex-column justify-content-between text-center px-6 py-5">
        <h3>Lasciati ispirare dalle buone pratiche</h3>
        <span>
          Una raccolta di esempi significativi e facili da replicare di come l'interoperabilità può
          semplificare i processi della Pubblica Amministrazione.
        </span>
      </div>
      <Col xs="8">
        <Row>
          <UseCaseCard
            title="cammello"
            description="ciao"
            isNew
            replicableBy={['a', 'b', 'c']}
            categoryTag="sette"
          />
        </Row>
        <Row>
          <UseCaseCard
            title="cammello"
            description="ciao"
            isNew
            replicableBy={['a', 'b', 'c']}
            categoryTag="sette"
          />
        </Row>
        <Row>
          <UseCaseCard
            title="cammello"
            description="ciao"
            isNew
            replicableBy={['a', 'b', 'c']}
            categoryTag="sette"
          />
        </Row>
      </Col>

      <Button color="primary" outline className="mb-5 mt-3"> Esplora altre buone pratiche </Button>
    </div>
  </Section>

  <Section>
    <div class="d-flex flex-row justify-content-between align-items-center">
      <h3>API in evidenza</h3>
      <a>
        <span class="tranform-uppercase">Esplora il catalogo</span>
        <Icon iconName="it-arrow-right" />
      </a>
    </div>
    <Row>
      <Col>
        <EServiceCard title="eservice 1" description="eservice description 1" />
      </Col>
      <Col>
        <EServiceCard title="eservice 2" description="eservice description 2" />
      </Col>
      <Col>
        <EServiceCard title="eservice 3" description="eservice description 3" />
      </Col>
    </Row>
  </Section>

  <SuggestionSection
    client:load
    title="Cosa fare per..."
    suggestions={[
      {
        icon: '/Group.svg',
        title: 'Ottenere l’accesso ai dati',
        description:
          'Iscriversi a PDND è semplice e veloce, avrai bisogno di firmare e inoltrare un accordo di adesione.',
        actionButton: {
          label: 'Aderisci a alla PDND',
          onClick: (): void => {},
          icon: 'it-arrow-right',
        },
      },
      {
        icon: '/Group.svg',
        title: 'Raccontare l’ecosistema',
        description:
          'Ottieni gli strumenti e le risorse per raccontare al meglio l’ecosistema di interoperabilità.',
        actionButton: { label: 'Consulta il press kit', onClick: (): void => {} },
      },
    ]}
  />

  <h1>
    Search Term: "{q}" Search Results (Total: {eservices.total}, Shown: {eservices.items.length})
  </h1>

  <ul>
    {
      eservices.items.map(
        (eservice: {
          id: string
          name: string
          tenant_name: string
          description: string
          technology: string
          mode: boolean
          created_at: string
        }) => (
          <li>
            <strong>{eservice.name}</strong>
            {eservice.tenant_name && <span> — {eservice.tenant_name}</span>}
            <p>{eservice.description}</p>
            <small>
              Tech: {eservice.technology} | Mode: {eservice.mode} | Created: {eservice.created_at}
            </small>
          </li>
        )
      )
    }
  </ul>

  <h2>Articles</h2>

  <ul>
    {articles.data.map((a: { title: string }) => <li>{a.title}</li>)}
  </ul>
</Layout>
